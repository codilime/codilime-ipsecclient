<div id=root>
  <div id=list>
    <h3>VRFs</h3>
    <ul id=list_ul class="list-group" *ngFor="let vrf of vrfs; index as i">
      <li class="list-group-item" (click)="setCurrentVRF(i)"
      (mouseover)="vrf.hover=true" (mouseleave)="vrf.hover=false"
      [ngStyle]="{'background-color': vrf.active ? '#00800020' : '#ffffff'}"
      ><span>{{vrf.client_name}}</span><i *ngIf="vrf.hover" class="fas fa-trash-alt vrf_trash"
        (click)="deleteVRF($event, i)"></i></li>
    </ul>
    <button type="button" class="btn btn-primary" (click)="addVRF()">Add a new VRF</button>
    <button type="button" class="btn btn-primary" (click)="unsetCurrentVRF()">Show all metrics</button>
  </div>
  <div id=edit_vrf *ngIf="currentVRF !== null">
    <div id=edit_title
    [ngStyle]="{'background-color': currentVRF.active ? '#00800020' : '#ffffff'}">
      <h3>{{currentVRF.client_name}}</h3>
      <button type="button" class="btn btn-success" (click)="saveAndApply()">Save & Apply</button>
    </div>
    <table class="table table-striped">
      <tbody>
        <tr>
          <td>Name</td>
          <td><input type=text class="form-control" [(ngModel)]=currentVRF.client_name /></td>
        </tr>
        <tr>
          <td>Active</td>
          <td><input type="checkbox" class="form-control" [(ngModel)]=currentVRF.active/></td>
        </tr>
        <tr>
          <td>Hardware support</td>
          <td><input type="checkbox" class="form-control" [(ngModel)]=currentVRF.hardware_support/></td>
        </tr>
        <tr>
          <td>VLAN</td>
          <td><input type=number class="form-control" [(ngModel)]=currentVRF.vlan /></td>
        </tr>
        <tr>
          <td>BGP Local AS</td>
          <td><input type=number class="form-control" [(ngModel)]=currentVRF.local_as /></td>
        </tr>
        <tr>
          <td>LAN IP / MASK</td>
          <td><input type=text class="form-control" [(ngModel)]=currentVRF.lan_ip /></td>
        </tr>
        <div *ngIf="currentVRF.hardware_support; then thenBlock; else elseBlock"></div><ng-template #thenBlock>
          <tr>
            <td>Crypto phase 1</td>
            <td class=crypto_td>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[0]>
                <option *ngFor="let encryption of hardware.encryption">{{encryption}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[1]>
                <option *ngFor="let integrity of hardware.integrity">{{integrity}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[2]>
                <option *ngFor="let key_exchange of hardware.key_exchange">{{key_exchange}}</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Crypto phase 2</td>
            <td class=crypto_td>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[0]>
                <option *ngFor="let encryption of hardware.encryption">{{encryption}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[1]>
                <option *ngFor="let integrity of hardware.integrity">{{integrity}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[2]>
                <option *ngFor="let key_exchange of hardware.key_exchange">{{key_exchange}}</option>
              </select>
            </td>
          </tr>
        </ng-template>
        <ng-template #elseBlock>
          <tr>
            <td>Crypto phase 1</td>
            <td class=crypto_td>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[0]>
                <option *ngFor="let encryption of software.encryption">{{encryption}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[1]>
                <option *ngFor="let integrity of software.integrity">{{integrity}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph1_list[2]>
                <option *ngFor="let key_exchange of software.key_exchange">{{key_exchange}}</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Crypto phase 2</td>
            <td class=crypto_td>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[0]>
                <option *ngFor="let encryption of software.encryption">{{encryption}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[1]>
                <option *ngFor="let integrity of software.integrity">{{integrity}}</option>
              </select>
              <select class="custom-select" [(ngModel)]=crypto_ph2_list[2]>
                <option *ngFor="let key_exchange of software.key_exchange">{{key_exchange}}</option>
              </select>
            </td>
          </tr>
        </ng-template>
      </tbody>
    </table>
    <h4>Endpoints</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Remote IP
          </th>
          <th>
            Local IP
          </th>
          <th>
            Peer IP
          </th>
          <th>
            PSK
          </th>
          <th>
            NAT
          </th>
          <th>
            BGP
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let endpoint of currentVRF.endpoints; index as i"
        (mouseover)="endpoint.hover=true" (mouseleave)="endpoint.hover=false">
          <td>{{endpoint.remote_ip_sec}}</td>
          <td>{{endpoint.local_ip}}</td>
          <td>{{endpoint.peer_ip}}</td>
          <td>{{endpoint.psk}}</td>
          <td><input type="checkbox" [(ngModel)]="endpoint.nat" /></td>
          <td><input type="checkbox" [(ngModel)]="endpoint.bgp" /></td>
          <td class=trash_cell>
            <i *ngIf="endpoint.hover" class="fas fa-trash-alt"
              (click)="deleteEndpoint(i)"></i>
          </td>
        </tr>
        <tr *ngIf="addingNewEndpoint">
          <td>
            <input type="text" class="form-control" [(ngModel)]="newEndpoint.remote_ip_sec"/>
          </td>
          <td>
            <input type="text" class="form-control" [(ngModel)]="newEndpoint.local_ip"/>
          </td>
          <td>
            <input type="text" class="form-control" [(ngModel)]="newEndpoint.peer_ip"/>
          </td>
          <td>
            <input type="text" class="form-control" [(ngModel)]="newEndpoint.psk"/>
          </td>
          <td>
            <input type="checkbox" [(ngModel)]="newEndpoint.nat"/>
          </td>
          <td>
            <input type="checkbox" [(ngModel)]="newEndpoint.bgp"/>
          </td>
          <td>
            <button type="button" class="btn btn-success" (click)="finishAddingEndpoint()"><i class="fas fa-check"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
    <button type="button" class="btn btn-primary" *ngIf="!addingNewEndpoint" (click)="startAddingEndpoint()"
      id=new_endpoint_btn>Add a new endpoint</button>
    <h4>BGP status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.bird | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
    <h4>Supervisor status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.supervisor | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
    <h4>Strongswan status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.strongswan | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
    <img id=ui_topo src="/assets/UI-topo.svg" id=ui_topo />
  </div>
  <div id=edit_vrf *ngIf="currentVRF == null">
    <h4>BGP status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.bird | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
    <h4>Supervisor status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.supervisor | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
    <h4>Strongswan status</h4>
    <table class="table">
      <thead>
        <tr>
          <th>
            Name
          </th>
          <th>
            Status
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of metrics.strongswan | keyvalue">
          <td>{{item.key}}</td>
          <td>{{item.value}}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
